function cout(a) {
}

function vSetDebugLoggingOn() {
}

function vout(a) {
}

function vobj(a) {
}

function vtime(a) {
}

function verror(a) {
    alert("ERROR: " + a);
    vDebugLoggingOn && console.log("ERROR: " + a)
}

function vResetTimer() {
    vLastTimer = (new Date).getTime()
}

function vShowTimer() {
    if (vDebugLoggingOn) {
        var a = (new Date).getTime();
        console.log("vtimer: " + (a - vLastTimer) + " (cur=" + a + " last=" + vLastTimer + ")");
        vLastTimer = a
    }
}

function VDatabase() {
    var a = this;
    this.load = function (d, e) {
        function b(k) {
            var n = k.substring(k.lastIndexOf("/") + 1, k.lastIndexOf("-Table 1"));
            VUtils.loadTextFromURL(k, function (p) {
                if (null != k.toLowerCase().indexOf(".csv")) {
                    var t = void 0;
                    void 0 == t && (t = ",");
                    t && 1 < t.length && (t = ",");
                    for (var u = 0, g = p.charAt(u), w = 0, y = 0, q = []; "" != g;) {
                        for (; " " == g || "\t" == g || "\r" == g;) g = p.charAt(++u);
                        var l = "";
                        if ('"' == g) {
                            g = p.charAt(++u);
                            do ('"' != g && (l += g, g = p.charAt(++u)), '"' == g) && '"' == p.charAt(u + 1) && (l += '"', u += 2, g = p.charAt(u)); while ("" !=
                            g && '"' != g);
                            if ("" == g) throw"Unexpected end of data, double-quote expected";
                            g = p.charAt(++u)
                        } else for (; "" != g && g != t && "\n" != g && "\t" != g && "\r" != g;) l += g, g = p.charAt(++u);
                        q.length <= w && q.push([]);
                        for (q[w].push(l); " " == g || "\t" == g || "\r" == g;) g = p.charAt(++u);
                        if (g == t) y++; else if ("\n" == g) y = 0, w++; else if ("" != g) throw"Delimiter expected after character " + u + "   " + g + "    " + g.charCodeAt(0);
                        if (g = p.charAt(++u), "" == g && 0 < w) for (; y < q[w - 1].length;) q[w].push(""), ++y
                    }
                    p = [];
                    t = [];
                    u = [];
                    for (g = 0; g < q[0].length; ++g) w = q[0][g], -1 != w.indexOf("[]") ?
                        u.push(!0) : u.push(!1), t.push(w.replace("[]", ""));
                    for (w = 1; w < q.length; ++w) {
                        y = q[w];
                        l = {};
                        for (g = 0; g < q[w].length; ++g) {
                            var z = y[g].replace(/^\s+|\s+$/gm, "");
                            u[g] ? (void 0 == l[t[g]] && (l[t[g]] = []), "[BLANK]" == z ? l[t[g]].push("") : "" != z && l[t[g]].push(z)) : l[t[g]] = z
                        }
                        p.push(l)
                    }
                    a[n] = p
                } else -1 != k.toLowerCase().indexOf(".json") ? a[n] = JSON.parse(p) : verror("VDatabase(): Unexpected file type: " + k);
                ++c;
                c < d.length ? b(d[c]) : e()
            })
        }

        var c = 0;
        b(d[c])
    }
}

function GUI(a, d) {
    function e(a, e, d, v) {
        var A = {}, h = a.indexOf("=");
        if (-1 == h) A.type = a, A.data = []; else for (A.type = a.substring(0, h), A.data = []; h < a.length - 1;) {
            var D = a.indexOf("|", h + 1);
            -1 == D && (D = a.length);
            A.data.push(a.substring(h + 1, D));
            h = D
        }
        a = (void 0 != e && (A.data.push(e), void 0 != d && (A.data.push(d), void 0 != v && A.data.push(v))), A);
        
        switch (f.abortOutlining(), a.type) {
            case "ClosePopup":
                b();
                0 != B && (--B, l());
                break;
            case "ToolsPopup":
                "ToolsPopup" == x ? (x = "", $(".v-options-popup").hide()) : (f.abortOutlining(), x = "ToolsPopup",
                    $(".v-rooms-popup").fadeOut(), $(".v-tiles-popup").fadeOut(), $(".v-grout-popup").fadeOut(), $(".v-paint-popup").fadeOut(), $(".v-options-popup").fadeIn(), $(".v-patterns-popup").fadeOut(), $(".v-email-popup").fadeOut(), $(".v-share-popup").fadeOut());
                break;
            case "RoomsPopup":
                c();
                break;
            case "TilesPopup":
                n();

                break;
            case "GroutPopup":
                "GroutPopup" == x ? (x = "", $(".v-grout-popup").hide()) : (f.abortOutlining(), x = "GroutPopup", t(), $(".v-options-popup").fadeOut(), $(".v-rooms-popup").fadeOut(), $(".v-tiles-popup").fadeOut(),
                    $(".v-grout-popup").fadeIn(), $(".v-paint-popup").fadeOut(), $(".v-patterns-popup").fadeOut(), $(".v-email-popup").fadeOut(), $(".v-share-popup").fadeOut());
                break;
            case "PaintPopup":
                "PaintPopup" == x ? (x = "", $(".v-paint-popup").hide()) : (f.abortOutlining(), x = "PaintPopup", u(), $(".v-options-popup").fadeOut(), $(".v-rooms-popup").fadeOut(), $(".v-tiles-popup").fadeOut(), $(".v-grout-popup").fadeOut(), $(".v-paint-popup").fadeIn(), $(".v-patterns-popup").fadeOut(), $(".v-email-popup").fadeOut(), $(".v-share-popup").fadeOut());
                break;
                case "AddPopup":
                "AddPopup" == x ? (x = "", $(".v-paint-popup").hide()) : (f.abortOutlining(), x = "PaintPopup", u(), $(".v-options-popup").fadeOut(), $(".v-rooms-popup").fadeOut(), $(".v-tiles-popup").fadeOut(), $(".v-grout-popup").fadeOut(), $(".v-paint-popup").fadeIn(), $(".v-patterns-popup").fadeOut(), $(".v-email-popup").fadeOut(), $(".v-share-popup").fadeOut());
                break;
            case "PatternsPopup":
                "PatternsPopup" == x ? (x = "", $(".v-patterns-popup").hide()) : f.isChangePatternMode() ? (f.setCurPattern(null), l()) : (x = "PatternsPopup", w(), $(".v-options-popup").fadeOut(), $(".v-tiles-popup").fadeOut(), $(".v-grout-popup").fadeOut(), $(".v-paint-popup").fadeOut(), $(".v-rooms-popup").fadeOut(), $(".v-patterns-popup").fadeIn());
                break;
            case "EmailPopup":
                "EmailPopup" == x ? (x = "", $(".v-email-popup").hide()) : (x = "EmailPopup", E = F = G = "", (-1 != location.href.indexOf("cjc-macbookpro") || -1 != location.href.indexOf("localhost")) &&
                (G = "Ashkan Ashtiani", F = "ashcan@3dln.com", E = ""), $(".v-email-entry input").eq(0).val(G), $(".v-email-entry input").eq(1).val(F), $(".v-email-entry textarea").val(E), $(".v-options-popup").fadeOut(), $(".v-tiles-popup").fadeOut(), $(".v-grout-popup").fadeOut(), $(".v-paint-popup").fadeOut(), $(".v-rooms-popup").fadeOut(), $(".v-patterns-popup").fadeOut(), $(".v-email-popup").fadeIn());
                break;
            case "EmailFrom":
                G = a.data[0];
                break;
            case "EmailTo":
                F = a.data[0];
                break;
            case "EmailMessage":
                E = a.data[0];
                break;
            case "SendEmail":
                f.sendEmail(G,
                    F, E);
                b();
                break;
            case "Print":
                f.print();
                break;
            case "addnew":
                f.print();
                break;
            case "SharePopup":
                "SharePopup" == x ? (x = "", $(".v-share-popup").hide()) : (x = "SharePopup", $(".v-preparing-share").hide(), $(".v-share").hide(), $(".v-options-popup").fadeOut(), $(".v-tiles-popup").fadeOut(), $(".v-grout-popup").fadeOut(), $(".v-paint-popup").fadeOut(), $(".v-rooms-popup").fadeOut(), $(".v-patterns-popup").fadeOut(), $(".v-email-popup").fadeOut(), $(".v-share-popup").fadeIn());
                break;
            case "Facebook":
                y("Facebook");
                break;
            case "Twitter":
                y("Twitter");
                break;
            case "Pinterest":
                y("Pinterest");
                break;
            case "SendShare":
                f.sendShare();
                b();
                break;
            case "Save":
                f.save();
                b();
                break;
            case "SelectRoomType":

                f.setCurRoomType(a.data[0]);
                k();
                break;
            case "SelectTileCategory":
                f.setCurTileCategory(a.data[0]);
                p();
                break;
            case "ToggleSingleTile":
                f.toggleSingleTileMode();
                l();
                q();
                b();
                f.isSingleTileMode() && n();
                break;
            case "ToggleRotateTile":
                f.toggleRotateTileMode();
                l();
                q();
                b();
                break;
            case "Search":
                f.curSearchString = a.data;
                alert(a.data);
                p();
                break;
            case "ToggleFilter":
                f.toggleFilter(a.data[0], a.data[1]);
                g();
                break;
            case "RemoveFilter":
                f.toggleFilter(a.data[0], a.data[1]);
                p();
                break;
            case "SelectRoomId":
                if ("Disabled" == a.data[0]) break;
                if (!f.setCurRoom(a.data[0])) break;
                k();
                b();
                0 != B && --B;
                z();
                break;
            case "SelectSavedRoom":
                f.setCurSavedRoom(a.data[0]);
                k();
                b();
                z();
                break;
            case "DeleteSavedRoom":
                f.deleteSavedRoom(a.data[0]);
                k();
                break;
            case "SelectTileSKU":
                if ("Disabled" == a.data[0]) ;
                f.setCurTileSKU(a.data[0]);
                p();
                q();
                b();
                H = !1;
                0 != B && (--B, l());
                $(".v-tiles-popup").removeClass("show");
                break;
            case "searchsku":
                if ("Disabled" == a.data[0]) break;
                f.setCurTileSKU(a.data[0]);
                p();
                q();
                b();
                H = !1;
                0 != B && (--B, l());
                $(".v-tiles-popup").removeClass("show");
                break;
            case "SelectGrout":
                f.setCurGrout(a.data[0]);
                t();
                q();
                b();
                break;
            case "SelectPaint":
                f.setCurPaint(a.data[0]);
                u();
                q();
                b();
                break;
            case "SelectPattern":
                a = a.data[0];
                null != a && $(".v-pattern-button").removeClass(f.getCurPattern());
                $(".v-pattern-button").addClass(a);
                f.setCurPattern(a);
                w();
                l();
                q();
                b();
                break;
            case "ShowFilters":
                f.showFilters();
                p();
                g();
                break;
            case "ShowFilteredTiles":
                f.showTiles();
                p();
                g();
                break;
            case "AddNewZone":
                f.addNewZone();
                b();
                break;
            case "DeleteZone":
                f.deleteZone();
                b();
                break;
            case "EditZone":
                f.editZone();
                b();
                break;
            case "TileZone":
                f.tileZone();
                b();
                break;
            case "GroutZone":
                f.groutZone();
                b();
                break;
            case "DeleteSingleTile":
                f.deleteSingleTile();
                b();
                break;
            case "MoveSingleTile":
                f.moveSingleTile();
                b();
                break;
            case "ChangeSingleTile":
                f.changeSingleTile();
                b();
                break;
            case "Clear":
                f.clear();
                l();
                b();
                break;
            case "Undo":
                f.undo();
                l();
                b();
                break;
            case "Redo":
                f.redo(), l(), b();
                break;
            case "selectedSKU":
                if ("Disabled" == a.data[0]) break;
                f.setCurTileSKU(a.data[0]);
                p();
                q();
                b();
                H = !1;
                0 != B && (--B, l());
                $(".v-tiles-popup").removeClass("show");
                break;

        }
    }

    function b() {
        var a = x;
        x = "";
        $(".v-rooms-popup").hide();
        $(".v-tiles-popup").hide();
        $(".v-grout-popup").hide();
        $(".v-paint-popup").hide();
        $(".v-patterns-popup").hide();
        $(".v-email-popup").hide();
        $(".v-share-popup").hide();
        $(".v-options-popup").hide();
        $(".v-decorate-actions-popup").hide();
        "TilesPopup" == a && (H = !1);
        "RoomsPopup" == a && H && z()
    }
    function selectsku(){
        if ("Disabled" == a.data[0]) ;
        f.setCurTileSKU(a.data[0]);
        p();
        q();
        b();
        H = !1;
        0 != B && (--B, l());
        $(".v-tiles-popup").removeClass("show");
    }
    function c() {

        if(window.location.href.indexOf("?saerch") > -1) {
            if ("RoomsPopup" == x) {
                return (x = "", void $(".v-rooms-popup").hide())
            }
            if ("RoomsPopup" != x) {
                return (f.abortOutlining(), x = "RoomsPopup", k(), $(".v-options-popup").fadeOut(), $(".v-tiles-popup").fadeOut(), $(".v-grout-popup").fadeOut(), $(".v-paint-popup").fadeOut(), $(".v-rooms-popup").fadeIn(), $(".v-patterns-popup").fadeOut(), $(".v-email-popup").fadeOut(), void $(".v-share-popup").fadeOut())

            }

        }
        else {
            if ("RoomsPopup" == x) {
                return (x = "", void $(".v-rooms-popup").hide())
            }
            if ("RoomsPopup" != x) {
                return (f.abortOutlining(), x = "RoomsPopup", k(), $(".v-options-popup").fadeOut(), $(".v-tiles-popup").fadeOut(), $(".v-grout-popup").fadeOut(), $(".v-paint-popup").fadeOut(), $(".v-rooms-popup").fadeIn(), $(".v-patterns-popup").fadeOut(), $(".v-email-popup").fadeOut(), void $(".v-share-popup").fadeOut())

            }
        }
    }

    function k() {
        for (var a = 0, d = "", b = 0; b < h.roomTypes.length; ++b) {
           
            var c = m.replace("[roomTypeText]", h.roomTypes[b].displayText);
            d += c.replace("[ACTION]", "SelectRoomType=" + h.roomTypes[b].type);
            h.roomTypes[b].type == f.getCurRoomType() && (a = b)
       
        }
        if ($(".v-rooms-popup-tabs").html(d), $(".v-rooms-popup-tabs li").removeClass("v-active"), $(".v-rooms-popup-tabs li").eq(a).addClass("v-active"), d = "", "Saved" == f.getCurRoomType()) for (b = 0; b < h.savedRooms.length; ++b) a = h.savedRooms[b], c = r.replace("thumbnails/rooms/template-placeholder.png",
            a.thumbnail), c = c.replace("SelectRoomId=[ROOMID]", "SelectSavedRoom=" + b), c = c.replace("[SAVEDROOMINDEX]", b), c = c.replace("[HIDE]", ""), d += c; else for (b = 0; b < h.rooms.length; ++b) if (a = h.rooms[b], "" == a.ignore && ("*" == f.getCurRoomType() || a.type == f.getCurRoomType())) {
            c = r.replace("template-placeholder.png", a.id + ".JPEG");
        
            var v = "";
            null != f.getCurRoom() && a.id == f.getCurRoom().id && (v = "v-active");
            c = c.replace("[ACTIVE]", v);
            v = "";
            a.disabled && (v = "v-disabled");
            c = c.replace("[DISABLED]", v);
            c = a.disabled ? c.replace("[ROOMID]", "Disabled") :
                c.replace("[ROOMID]", h.rooms[b].id);
            c = c.replace("[HIDE]", "v-hide");
            d += c
        }
        $(".v-room-thumbnails-inject").html(d);
        $(".v-rooms-popup .v-actiond").click(function () {
            e($(this).data("v-action"))
        })
    }

    function n() {
        if(window.location.href.indexOf("?saerch") > -1) {

            if ("TilesPopup" == x) {
                return (x = "", void $(".v-tiles-popup").hide())
            }
            if ("TilesPopup" != x) {
                return (f.abortOutlining(), x = "TilesPopup", p(), $(".v-options-popup").fadeOut(), $(".v-rooms-popup").fadeOut(), $(".v-tiles-popup").fadeIn(), $(".v-grout-popup").fadeOut(), $(".v-paint-popup").fadeOut(), $(".v-patterns-popup").fadeOut(), $(".v-email-popup").fadeOut(),
                    void $(".v-share-popup").fadeOut())
            }
        }
            else{
                if("TilesPopup" == x){
                    return  (x = "", void $(".v-tiles-popup").hide())
                }
                if("TilesPopup" != x){
                    return  (f.abortOutlining(), x = "TilesPopup", p(), $(".v-options-popup").fadeOut(), $(".v-rooms-popup").fadeOut(), $(".v-tiles-popup").fadeIn(), $(".v-grout-popup").fadeOut(), $(".v-paint-popup").fadeOut(), $(".v-patterns-popup").fadeOut(), $(".v-email-popup").fadeOut(),
                        void $(".v-share-popup").fadeOut())
                }
            }

        }

        // return "TilesPopup" == x ? (x = "", void $(".v-tiles-popup").hide()) : (f.abortOutlining(), x = "TilesPopup", p(), $(".v-options-popup").fadeOut(), $(".v-rooms-popup").fadeOut(), $(".v-tiles-popup").fadeIn(), $(".v-grout-popup").fadeOut(), $(".v-paint-popup").fadeOut(), $(".v-patterns-popup").fadeOut(), $(".v-email-popup").fadeOut(),
        //     void $(".v-share-popup").fadeOut())


    function p() {
        function a(a) {
            return "" != f.curSearchString && -1 == a.name.toLowerCase().indexOf(f.curSearchString) && -1 == a.category.toLowerCase().indexOf(f.curSearchString) && -1 == a.finish.toLowerCase().indexOf(f.curSearchString) ? !1 : !0
        }

        function b(a) {
            for (var c = 0, d = 0; d < h.tileFilters.length; ++d) {
                for (var b = 0, e = 0; e < h.tileFilters[d].filterValues.length; ++e) if (f.filterIsOn(h.tileFilters[d].tileProperty, h.tileFilters[d].filterValues[e]) && (++b, a[h.tileFilters[d].tileProperty] == h.tileFilters[d].filterValues[e])) {
                    ++c;
                    break
                }
                0 == b && ++c
            }
            return vout(c), c == h.tileFilters.length ? !0 : !1
        }

        if (f.showingFilters) return void $(".v-tile-selection").hide();
        for (var d = 0, e = "", c = 0; c < h.tileCategories.length; ++c) {
            var v = C.replace("[tileCategoryText]", h.tileCategories[c].displayText);
            e += v.replace("[ACTION]", "SelectTileCategory=" + h.tileCategories[c].category);
            h.tileCategories[c].category == f.curTileCategory && (d = c)
        }
        $(".v-tiles-popup-tabs-inject").html(e);
        $(".v-tiles-popup-tabs li").removeClass("v-active");
        $(".v-tiles-popup-tabs li").eq(d).addClass("v-active");
        "Recent" == f.curTileCategory ? $(".v-search-container").hide() : $(".v-search-container").show();
        e = "";
        for (c = 0; c < h.tileFilters.length; ++c) {
            for (d = 0; d < h.tileFilters[c].filterValues.length; ++d) f.filterIsOn(h.tileFilters[c].tileProperty, h.tileFilters[c].filterValues[d]) && (v = D.replace("[FILTERONBUTTONTEXT]", h.tileFilters[c].filterValues[d]), v = v.replace("[tileProperty]", h.tileFilters[c].tileProperty), v = v.replace("[filterValue]", h.tileFilters[c].filterValues[d]), e += v);
            $(".v-tile-filters-inject").html(e)
        }
        d = [];
        "Recent" == f.curTileCategory && ($("#filters").hide(), $("#products").hide(), setTimeout(function () {
            $(".v-tile-thumbnails-inject").find(".col-xs-3").show().addClass("bang");
            $(".v-tile-thumbnails-inject").find(".col-xs-3").css("display", "block !important")
        }, 100));
        "*" == f.curTileCategory && ($("#filters").show(), $("#products").show());
        if ("Recent" == f.curTileCategory) for (c = 0; c < f.recentlyUsedTiles.length; ++c) {
            var g = f.recentlyUsedTiles[c];
            d.push(g)
        } else for (c = 0; c < h.tiles.length; ++c) g = h.tiles[c], ("*" == f.curTileCategory ||
            g.category == f.curTileCategory) && a(g) && b(g) && d.push(g);
        e = "";
        for (c = 0; c < d.length; ++c) {
            g = d[c];
            v = J.replace("images/template-placeholder.png", g.thumbnail);
            var n = "";
            null != f.getCurTile() && g.sku == f.getCurTile().sku && (n = "v-active");
            v = v.replace("[ACTIVE]", n);
            n = "";
            g.disabled && (n = "v-disabled");
            v = v.replace("[DISABLED]", n);
            v = g.disabled ? v.replace("[SKU]", "Disabled") : v.replace("[SKU]", g.sku);
            e += v.replace("[TILETHUMBNAILTEXT]", g.name + " " + g.sku + " (" + g.widthCM + "x" + g.heightCM + "cm)")
        }
        $(".v-tile-thumbnails-inject").html(e);
        $(".v-tile-selection").show()
    }

    function t() {
        for (var a = "", c = 0; c < h.grout.length; ++c) {
            var d = h.grout[c], b = K.replace("[GROUTCOLOUR]", d.rgb), v = "";
            null != f.getCurGrout() && d.rgb == f.getCurGrout() && (v = "v-active");
            b = b.replace("[ACTIVE]", v);
            a += b.replace("background-color: red", "background-color: #" + d.rgb)
        }
        $(".v-grout-thumbnails-inject").html(a);
        $(".v-grout-popup .v-actiond").click(function () {
            e($(this).data("v-action"))
        })
    }

    function u() {
        for (var a = "", c = 0; c < h.paint.length; ++c) {
            var d = h.paint[c], b = v.replace("[PAINTCOLOUR]",
                d.rgb), g = "";
            null != f.getCurPaint() && d.rgb == f.getCurPaint() && (g = "v-active");
            b = b.replace("[ACTIVE]", g);
            a += b.replace("background-color: red", "background-color: #" + d.rgb)
        }
        $(".v-paint-thumbnails-inject").html(a);
        $(".v-paint-popup .v-actiond").click(function () {
            e($(this).data("v-action"))
        })
    }

    function g() {
        if (!f.showingFilters) return void $(".v-filters-container").hide();
        for (var a = "", c = 0; c < h.tileFilters.length; ++c) a += L.replace("[FILTERTITLE]", h.tileFilters[c].title);
        $(".v-filter-groups-list").html(a);
        for (c =
                 0; c < h.tileFilters.length; ++c) {
            a = "";
            for (var d = 0; d < h.tileFilters[c].filterValues.length; ++d) {
                var b = M.replace("[FILTERBUTTONTEXT]", h.tileFilters[c].filterValues[d]);
                b = b.replace("[tileProperty]", h.tileFilters[c].tileProperty);
                b = b.replace("[filterValue]", h.tileFilters[c].filterValues[d]);
                b = f.filterIsOn(h.tileFilters[c].tileProperty, h.tileFilters[c].filterValues[d]) ? b.replace("[ACTIVE]", "v-active") : b.replace("[ACTIVE]", "");
                a += b
            }
            $(".v-filter-group-buttons-list").eq(c).html(a)
        }
        $(".v-filters-container").show();
        $(".v-filter-groups-list .v-actiond").click(function () {
            e($(this).data("v-action"))
        })
    }

    function w() {
        $(".v-pattern-thumbnail-container").removeClass("v-active");
        $('.v-pattern-thumbnail-container[data-v-pattern="' + f.getCurPattern() + '"]').addClass("v-active");
        $(".v-patterns-popup .v-actiond").click(function () {
            e($(this).data("v-action"))
        })
    }

    function y(a) {
        $(".v-preparing-share").show();
        f.prepareShare(a, function () {
            $(".v-preparing-share").hide();
            $(".v-share").show()
        })
    }

    function q() {
        if ("Tile" == f.getCurDecorateMode()) {
            if ($(".v-selected-tile-thumbnail").hide(),
                    $(".v-selected-tile-thumbnail").removeClass("v-active"), null != f.getCurTile()) {
                for (var a = 0, c = 0; c < f.recentlyUsedTiles.length; ++c) {
                    var d = f.recentlyUsedTiles[c];
                    if ($(".v-selected-tile-thumbnail").eq(4 - c).attr("src", d.thumbnail), $(".v-selected-tile-thumbnail").eq(4 - c).show(), d.sku == f.getCurTile().sku && $(".v-selected-tile-thumbnail").eq(4 - c).addClass("v-active"), $(".v-selected-tile-thumbnail").eq(4 - c).data("v-action", "SelectTileSKU=" + d.sku), ++a, 5 == a) break
                }
                $(".v-current-selections").show()
            } else $(".v-current-selections").hide();
            $(".v-selected-pattern-icon").hide();
            $(".v-tiling-mode-container").hide();
            $(".v-selected-grout").hide();
            $(".v-selected-paint").hide()
        } else "Grout" == f.getCurDecorateMode() ? ($(".v-selected-grout").css("background-color", "#" + f.getCurGrout()), $(".v-current-selections").show(), $(".v-selected-grout").show(), $(".v-selected-tile-thumbnail").hide(), $(".v-tiling-mode-container").hide(), $(".v-selected-pattern-icon").hide(), $(".v-selected-paint").hide()) : ($(".v-selected-paint").css("background-color", "#" + f.getCurPaint()),
            $(".v-current-selections").show(), $(".v-selected-grout").show(), $(".v-selected-tile-thumbnail").hide(), $(".v-tiling-mode-container").hide(), $(".v-selected-pattern-icon").hide(), $(".v-selected-paint").show(), $(".v-selected-grout").hide())
    }

    function l() {
        f.anythingToUndo() ? $(".v-undo-button").show() : $(".v-undo-button").hide();
        f.anythingToUndo() ? $(".v-clear-all-button").show() : $(".v-clear-all-button").hide();
        f.anythingToRedo() ? $(".v-redo-button").show() : $(".v-redo-button").hide();
        f.isRoomDecorated() ? ($(".v-save-button").show(),
            $(".v-print-button").show(), $(".v-email-button").show(), $(".v-share-button").show()) : ($(".v-save-button").hide(), $(".v-print-button").hide(), $(".v-email-button").hide(), $(".v-share-button").hide());
        f.isSingleTileMode() ? $(".v-single-tile-button").addClass("v-active") : $(".v-single-tile-button").removeClass("v-active");
        f.isRotateTileMode() ? $(".v-rotate-tile-button").addClass("v-active") : $(".v-rotate-tile-button").removeClass("v-active");
        f.isChangePatternMode() ? $(".v-pattern-button").addClass("v-active") :
            $(".v-pattern-button").removeClass("v-active");
        0 == B ? ($(".v-left-button-group").show(), $(".v-right-button-group").show(), $(".v-top-button-group").show()) : ($(".v-left-button-group").hide(), $(".v-right-button-group").hide(), $(".v-top-button-group").hide())
    }

    function z() {
        H && null == f.getCurTile() && n();
        H = !1
    }

    var f = a, h = d, m = $(".v-rooms-popup-tab-template").html(), r = $(".v-room-thumbnail-template").html(),
        C = $(".v-tiles-popup-tab-template").html(), D = $(".v-filter-on-button-template").html(),
        J = $(".v-tile-thumbnail-template").html(),
        L = $(".v-filter-group-template").html(), M = $(".v-filter-button-template").html(),
        K = $(".v-grout-thumbnail-template").html(), v = $(".v-paint-thumbnail-template").html(), x = "", I = null,
        G = "", F = "", E = "", H = !0, B = 2;
    -1 != location.href.indexOf("cjc-macbookpro") && (B = 0);
    $(".v-action").click(function () {
        e($(this).data("v-action"))
    });
    $(".v-action-key").keyup(function () {
        e($(this).data("v-action"), $(this).val())
    });
    $(".v-decorate-actions-popup .v-actiond").click(function () {
        e($(this).data("v-action"))
    });
    this.setup = function () {
        g();

        for (var a = 0; a < h.roomTypes.length; ++a) if ("y" == h.roomTypes[a].defaultTo) {
            f.setCurRoomType(h.roomTypes[a].type);
            k();
            break
        }
        for (a = 0; a < h.tileCategories.length; ++a) if ("y" == h.tileCategories[a].defaultTo) {
            f.setCurTileCategory(h.tileCategories[a].category);
            break
        }
        q();
        $(".v-pattern-button").addClass(f.getCurPattern());
        $(".v-page-container").fadeIn();
        for (a = 0; a < h.rooms.length; ++a) if ("" != h.rooms[a].initialLoad) {
            f.setCurRoom(h.rooms[a].id);
            break
        }
        l();
        VUtils.isTabletOrPhoneDevice() && $(".v-icon-button").addClass("v-disable-touch-button-hover")
    };
    this.showMessage = function (a, c) {
        if (vout("showMessage(): " + a), void 0 == c ? c = 3E3 : -1 == c && (c = 999999), null != I && (clearTimeout(I), I = null), null == a) return void $(".v-message").hide();
        for (; -1 != a.indexOf("[click]");) a = VUtils.isTabletOrPhoneDevice() ? a.replace("[click]", "tap") : a.replace("[click]", "click");
        for (; -1 != a.indexOf("[Click]");) a = VUtils.isTabletOrPhoneDevice() ? a.replace("[Click]", "Tap") : a.replace("[Click]", "Click");
        $(".v-message").html(a);
        $(".v-message").show();
        I = setTimeout(function () {
                I = null;
                $(".v-message").hide()
            },
            c)
    };
    this.message = function (a) {
        null == a ? $(".v-message").fadeOut() : ($(".v-message").html(a), $(".v-message").fadeIn())
    };
    this.showSelectRoomPopup = function () {
        c()
    };
    this.showSelectTilesPopup = function () {
        n()
    };
    this.decorateActionsPrompt = function (a) {
        vobj(a);
        $(".v-decorate-action-button").hide();
        for (var c = 0; c < a.length; ++c) $(".v-decorate-action-button.v-action-" + a[c]).show();
        $(".v-decorate-actions-popup").fadeIn()
    };
    this.updateButtons = function () {
        l()
    };
    this.action = function (a, c, d, b) {
        e(a, c, d, b)
    }

}

function TilesVisualiser(a) {
    function d() {
        function a(c, d) {
            if (c == m.tiles.length) return void alert("Finished");
            var b = m.tiles[c];
            if ("" != b.dontMakeThumbnail) return void a(c + 1);
            vout("Making thumbnail: " + b.sku);
            var f = new VTileSet;
            f.setup(b.sku, !1);
            f.load("tiles/" + b.sku + "_c.png", function () {
                VUtils.getRandom();
                var d = f.tiles[0], g = document.createElement("canvas");
                g.height = 200;
                g.width = d.w * g.height / d.h;
                var h = g.getContext("2d");
                h.fillStyle = "#FFFFFF";
                h.fillRect(0, 0, g.width, g.height);
                h.drawImage(f.canvas, d.x, d.y,
                    d.w, d.h, 0, 0, g.width, g.height);
                e(g, "thumbnails/tiles", "thumbnails/tiles/" + b.sku + ".jpg", .8, function () {
                    a(c + 1)
                })
            })
        }

        alert("Making all thumbnails");
        a(0)
    }

    function ee(a, c, d, b, e) {

        a = {
            base64Data: a.toDataURL("image/jpeg", b).replace(/^data:image\/(png|jpeg);base64,/, ""),
            folder: c,
            filename: d
        };
        $.post("vsavebase64.php", a, function (a) {
            null != e && e()
        })
    }

    if (!VUtils.webGLSupported()) return void alert("This application requires a browser that supports WebGL");
    var b = this;
    a = 14;
    -1 != location.href.indexOf("cjc-macbookpro") && (a +=
        (new Date).getTime());
    var c = null, k = !0, n = !1;
    this.showingFilters = !1;
    var p = null, t = "Tile", u = null, g = "FFFFFF", w = "", y = "Linear", q = "Undefined";
    this.curTileCategory = "Undefined";
    var l = !1, z = !1, f = !1;
    this.curSearchString = "";
    var h = {};
    this.recentlyUsedTiles = [];
    var m = new VDatabase, r = new GUI(b, m);
    r.showMessage("\u062f\u0631 \u062d\u0627\u0644 \u0628\u0627\u0631\u06af\u0632\u0627\u0631\u06cc...", -1);
    var C = ["database/TileMountainDatabase/rooms-Table 1.csv?" + a, "database/TileMountainDatabase/tileAreas-Table 1.csv?" + a,
        "database/TileMountainDatabase/roomTypes-Table 1.csv?" + a, "database/TileMountainDatabase/tiles-Table 1.csv?" + a, "database/TileMountainDatabase/tileCategories-Table 1.csv?" + a, "database/TileMountainDatabase/grout-Table 1.csv?" + a, "database/TileMountainDatabase/paint-Table 1.csv?" + a, "database/TileMountainDatabase/tileFilters-Table 1.csv?" + a];
    (function (a) {
        function c(a) {
            m.load(C, function () {
                for (var c = [], d = 0; d < m.tiles.length; ++d) {
                    var b = m.tiles[d], e = m.xmlFeed[b.sku];
                    if (void 0 != e) {
                        if ("" == b.sku && (b.ignore = "y"),
                            "" == b.ignore) {
                            b.disabled = !1;
                            b.name = e.name;
                            b.thumbnail = "thumbnails/tiles/" + b.sku + ".jpg";
                            b.type = "Tile";
                            "mosaic" == e.productType.toLowerCase() && (b.type = "Mosaic");
                            b.widthCM = parseFloat(e.width / 10);
                            b.heightCM = parseFloat(e.height / 10);
                            for (var f = [300, "Small", 600, "Medium"], g = "Large", n = 0; n < f.length; n += 2) if (b.size.split("x")[0] <= f[n] && b.size.split("x")[1] <= f[n]) {
                                g = f[n + 1];
                                break
                            }
                            b.size = g;
                            "" != b.noSingleTile ? b.noSingleTile = !0 : b.noSingleTile = !1;
                            b.patternsAllowed = "," + b.patternsAllowed + ",";
                            b.is = "Tile";
                            b.displaySize =
                                "";
                            "" == b.canGo && (b.canGo = "Both");
                            b.canGoWhere = "Both";
                            b.isBorder = !1;
                            b.patternsAllowed = ",All,";
                            -1 != b.name.toLowerCase().indexOf("mosaic") && (b.patternsAllowed = ",Linear,");
                            b.canGo = "Both";
                            "wall" == e.floorOrWall ? b.canGo = "Wall" : "floor" == e.floorOrWall && (b.canGo = "Floor");
                            b.width = 10 * Math.max(b.widthCM, b.heightCM);
                            b.height = 10 * Math.min(b.widthCM, b.heightCM);
                            b.smallMosaicsW = 1;
                            b.smallMosaicsH = 1;
                            "Mosaic" == b.type && (b.width = 10 * b.widthCM, b.height = 10 * b.heightCM, b.smallMosaicsW = parseInt(b.numSmallMosaics.split(",")[0]),
                                b.smallMosaicsH = parseInt(b.numSmallMosaics.split(",")[1]), "" != b.mosaicsMultiplier ? (b.mosaicsMultiplierW = b.mosaicsMultiplier.split(",")[0], b.mosaicsMultiplierH = b.mosaicsMultiplier.split(",")[1]) : (b.mosaicsMultiplierW = 1, b.mosaicsMultiplierH = 1), b.mosaicsMultiplierW = -1, b.mosaicsMultiplierH = -1);
                            "" != b.overrideWH && (b.width = parseInt(b.overrideWH.split(",")[0]), b.height = parseInt(b.overrideWH.split(",")[1]));
                            c.push(b)
                        }
                    } else vout("@@@ ignore " + b.sku)
                }
                m.tiles = c;
                m.tilesList = "";
                for (d = 0; d < m.tiles.length; ++d) m.tilesList +=
                    "," + m.tiles[d].sku + ",";
                for (d = 0; d < m.tileFilters.length; ++d) {
                    c = m.tileFilters[d];
                    e = c.tileProperty;
                    for (n = 0; n < m.tiles.length; ++n) b = m.tiles[n], "processed" == b.ignore && "" != b[e] && -1 == c.filterValues.indexOf(b[e]) && c.filterValues.push(b[e]);
                    c.filterValues = [];
                    c.filterValues.push("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                    c.filterValues.push("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                    c.filterValues.push("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                    c.filterValues.push("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                    c.filterValues.push("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                    c.filterValues.push("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                    c.filterValues.push("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                    c.filterValues.push("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                    c.filterValues.push("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");
                    c.filterValues.sort();
                    h[c.tileProperty] = []
                }
                a()
            })
        }

        (function (a) {
            m.xmlFeed = {};
            $.ajax({
                type: "GET",
                url: 'loade_tile.php' ,
                dataType: "xml",
                success: function (resultss) {


            VUtils.loadXMLFromURL(resultss,
                function (b) {
                    $xml = $(b);
                    $xml.find("item").each(function (a) {
                        a = {};
                        a.sku = $("sku", this).text();
                        a.name = $("name", this).text();
                        a.size = $("size", this).text();
                        a.width = parseInt($("width", this).text());
                        a.height = parseInt($("height", this).text());
                        a.image = $("image", this).text();
                        a.productType = $("product_type", this).text();
                        m.xmlFeed[a.sku] = a;
                        a.floorOrWall = $("floor_or_wall", this).text().toLowerCase();

                    });

                    a()
                })
                }
            });
        })
        (function () {
            c(function () {
                a()
            })
        })
    })(function () {
        c = new VTilingEngine(b, m);
        c.setup();
        c.configure("TilesVisualiser",
            "1.00", "#000000", "#444444", "#ffffff", "#444444", "C7F5C7");
        c.setOption("AddGroutThickness", 2);
        m.savedRooms = c.getSavedRooms();
        r.setup();
        -1 != location.href.indexOf("cjc-macbookpro") && b.setCurTileSKU(m.tiles[0].sku);
        -1 != location.href.indexOf("maketilethumbnails") && d()
    });
    this.action = function (a, b, c, d) {
        r.action(a, b, c, d)
    };
    this.broadcastAction = function (a) {
        switch (a) {
            case "ShowSelectTilesPopup":
                r.showSelectTilesPopup()
        }
    };
    this.broadcastMessage = function (a) {
        switch (vout("*** broadcastMessage: " + a), a) {
            case null:
                r.showMessage(null);
                break;
            case "LoadingRoom":
                r.showMessage("<img src='images/al.gif' />\u0628\u0627\u0631\u06af\u0632\u0627\u0631\u06cc...", -1);
                break;
            case "Updating":
                r.showMessage("<img src='images/al.gif' />\u0628\u0647 \u0631\u0648\u0632 \u0631\u0633\u0627\u0646\u06cc...", -1);
                break;
            case "CannotTileWithoutTileSelected":
                r.showMessage("\u0627\u0648\u0644 \u06cc\u06a9 \u06a9\u0627\u0634\u06cc \u0627\u0646\u062a\u062e\u0627\u0628 \u06a9\u0646\u06cc\u062f");
                break;
            case "CannotGroutWhereNoTiles":
                r.showMessage("\u0627\u0648\u0644 \u06a9\u0627\u0634\u06cc\u200c\u06a9\u0627\u0631\u06cc \u06a9\u0646\u06cc\u062f...");
                break;
            case "SurfaceCannotBePainted":
                r.showMessage("\u0627\u06cc\u0646 \u0633\u0637\u062d \u0642\u0627\u0628\u0644 \u0631\u0646\u06af\u200c\u0622\u0645\u06cc\u0632\u06cc \u0646\u06cc\u0633\u062a");
                break;
            case "PatternChangeNoTiles":
                r.showMessage("\u06a9\u0627\u0634\u06cc\u200c\u0627\u06cc \u0628\u0631\u0627\u06cc \u062a\u063a\u06cc\u06cc\u0631 \u0648\u062c\u0648\u062f \u0646\u062f\u0627\u0631\u062f!");
                break;
            case "PatternChangePatternNotAllowed":
                r.showMessage("\u0627\u06cc\u0646 \u06a9\u0627\u0634\u06cc \u0628\u0647 \u0627\u06cc\u0646 \u0634\u06a9\u0644 \u0642\u0627\u0628\u0644 \u0686\u06cc\u0646\u0634 \u0646\u06cc\u0633\u062a");
                break;
            case "TileSurfaceBeforePlacingSingleTile":
                r.showMessage("\u0627\u0648\u0644 \u0633\u0637\u062d \u0631\u0627 \u06a9\u0627\u0634\u06cc\u200c\u06a9\u0627\u0631\u06cc \u06a9\u0646\u06cc\u062f \u0628\u0639\u062f \u0646\u06a9 \u06a9\u0627\u0634\u06cc \u0631\u0627 \u0642\u0631\u0627\u0631 \u062f\u0647\u06cc\u062f");
                break;
            case "NoTilesToRotate":
                r.showMessage("\u06a9\u0627\u0634\u06cc\u200c\u0627\u06cc \u0628\u0631\u0627\u06cc \u0686\u0631\u062e\u0627\u0646\u062f\u0646 \u0648\u062c\u0648\u062f \u0646\u062f\u0627\u0631\u062f");
                break;
            case "CantRotateSquareTiles":
                r.showMessage("\u06a9\u0627\u0634\u06cc\u200c\u0647\u0627\u06cc \u0645\u0631\u0628\u0639 \u0634\u06a9\u0644 \u0642\u0627\u0628\u0644 \u0686\u0631\u062e\u0627\u0646\u062f\u0646 \u0646\u06cc\u0633\u062a\u0646\u062f");
                break;
            case "SendingEmail":
                r.showMessage("<img src='images/al.gif' />\u0627\u0631\u0633\u0627\u0644 \u0627\u06cc\u0645\u06cc\u0644");
                break;
            case "Saving":
                r.showMessage("<img src='images/al.gif' />\u0630\u062e\u06cc\u0631\u0647\u200c\u0633\u0627\u0632\u06cc");
                break;
            case "CannotAddSingleTilesToPattern":
                r.showMessage("\u0628\u0647 \u0627\u06cc\u0646 \u0686\u06cc\u062f\u0645\u0627\u0646 \u0646\u0645\u06cc\u062a\u0648\u0627\u0646 \u062a\u06a9 \u06a9\u0627\u0634\u06cc \u0627\u0636\u0627\u0641\u0647 \u06a9\u0631\u062f");
                break;
            case "EditZone":
                r.showMessage("\u0627\u06cc\u0646 \u0646\u0627\u062d\u06cc\u0647 \u0631\u0627 \u0645\u06cc\u062a\u0648\u0627\u0646\u06cc\u062f \u0628\u0627 \u06a9\u0634\u06cc\u062f\u0646 \u062f\u0633\u062a\u06af\u06cc\u0631\u0647\u200c\u0647\u0627 \u062a\u063a\u06cc\u06cc\u0631 \u0633\u0627\u06cc\u0632 \u062f\u0647\u06cc\u062f \u06cc\u0627 \u062c\u0627\u0628\u062c\u0627 \u06a9\u0646\u06cc\u062f",
                    2E3);
                break;
            case "TileCannotGoOnWall":
                r.showMessage("\u0627\u06cc\u0646 \u06a9\u0627\u0634\u06cc \u0645\u0646\u0627\u0633\u0628 \u062f\u06cc\u0648\u0627\u0631 \u0646\u06cc\u0633\u062a", 1500);
                break;
            case "TileCannotGoOnFloor":
                r.showMessage("\u0627\u06cc\u0646 \u06a9\u0627\u0634\u06cc \u0645\u0646\u0627\u0633\u0628 \u06a9\u0641 \u0646\u06cc\u0633\u062a", 1500)
        }
    };
    this.abortOutlining = function () {
        c.abortOutlining()
    };
    this.decorateActionsPrompt = function (a) {
        r.decorateActionsPrompt(a)
    };
    this.decorated = function () {
        l =
            f = !1;
        r.updateButtons()
    };
    this.getDatabase = function () {
        return m
    };
    this.showFilters = function () {
        this.showingFilters = !0
    };
    this.showTiles = function () {
        this.showingFilters = !1
    };
    this.save = function () {
        c.save();
        m.savedRooms = c.getSavedRooms()
    };
    this.deleteSavedRoom = function (a) {
        c.deleteSavedRoom(a);
        m.savedRooms = c.getSavedRooms()
    };
    this.setCurSavedRoom = function (a) {
        if (n) return !1;
        n = !0;
        for (var b = 0; b < m.rooms.length; ++b) if (m.rooms[b].id == m.savedRooms[a].roomId) {
            p = m.rooms[b];
            break
        }
        return c.setCurSavedRoom(a, function () {
            n = !1
        }),
            !0
    };
    this.setCurRoom = function (a) {
        if (n) return !1;
        n = !0;
        for (var b = 0; b < m.rooms.length; ++b) if (m.rooms[b].id == a) {
            p = m.rooms[b];
            break
        }
        return c.setCurStockRoom(a, function () {
            n = !1;
            k && -1 == location.href.indexOf("cjc-macbookpro") && r.showSelectRoomPopup();
            k = !1;
            c.renderUndecoratedStockScene();
            r.updateButtons()
        }), !0
    };
    this.getCurRoom = function () {
        return p
    };
    this.getCurDecorateMode = function () {
        return t
    };
    this.setCurTileSKU = function (a) {
        null == u && r.showMessage("\u0628\u0631\u0627\u06cc \u06a9\u0627\u0634\u06cc\u200c\u06a9\u0627\u0631\u06cc \u0631\u0648\u06cc \u06cc\u06a9 \u0633\u0637\u062d \u06a9\u0644\u06cc\u06a9 \u06a9\u0646\u06cc\u062f");
        for (var d = 0; d < m.tiles.length; ++d) if (m.tiles[d].sku == a) {
            u = m.tiles[d];
            t = "Tile";
            d = m.tiles[d];
            for (var e = 0; e < b.recentlyUsedTiles.length; ++e) if (b.recentlyUsedTiles[e].sku == d.sku) {
                b.recentlyUsedTiles.splice(e, 1);
                break
            }
            b.recentlyUsedTiles.unshift(d);
            c.setCurTileSKU(a);
            l = f = !1;
            r.updateButtons();
            break
        }
    };
    this.tileExists = function (a) {
        return void 0 == m.tilesList ? !1 : -1 != m.tilesList.indexOf("," + a + ",") ? !0 : !1
    };
    this.getCurTile = function () {
        return u
    };
    this.setCurGrout = function (a) {
        g = a;
        t = "Grout";
        c.setCurGrout(a);
        z = f = !1
    };
    this.getCurGrout =
        function () {
            return g
        };
    this.setCurPaint = function (a) {
        w = a;
        t = "WallColour";
        c.setCurPaint(a);
        z = f = !1
    };
    this.getCurPaint = function () {
        return w
    };
    this.setCurPattern = function (a) {
        return null == a ? (l = !1, void c.setCurPattern(null)) : (y = a, c.setCurPattern(a), t = "Tile", l = !0, f = !1, void(z = !1))
    };
    this.isChangePatternMode = function () {
        return l
    };
    this.getCurPattern = function () {
        return y
    };
    this.setCurRoomType = function (a) {
        return q = a
    };
    this.getCurRoomType = function () {
        return q
    };
    this.setCurTileCategory = function (a) {
        b.curTileCategory = a
    };
    this.toggleSingleTileMode =
        function () {
            z = !z;
            t = "Tile";
            c.setSingleTileMode(z);
            l = f = !1
        };
    this.isSingleTileMode = function () {
        return z
    };
    this.toggleRotateTileMode = function () {
        f = !f;
        t = "Tile";
        c.setRotateTileMode(f);
        z = l = !1
    };
    this.isRotateTileMode = function () {
        return f
    };
    this.toggleFilter = function (a, b) {
        var c = h[a].indexOf(b);
        -1 == c ? h[a].push(b) : h[a].splice(c, 1);
        vobj(h)
    };
    this.filterIsOn = function (a, b) {
        return -1 != h[a].indexOf(b) ? !0 : !1
    };
    this.addNewZone = function () {
        f = z = l = !1;
        r.updateButtons();
        r.showMessage("\u0631\u0648\u06cc \u06cc\u06a9 \u0633\u0637\u062d \u06a9\u0644\u06cc\u06a9 \u06a9\u0646\u06cc\u062f \u062a\u0627 \u0645\u0646\u0637\u0642\u0647 \u062c\u062f\u06cc\u062f\u06cc \u0627\u06cc\u062c\u0627\u062f \u0634\u0648\u062f",
            3E4);
        c.addNewZone()
    };
    this.deleteZone = function () {
        c.deleteZone()
    };
    this.editZone = function () {
        r.showMessage("\u0628\u0627 \u06a9\u0634\u06cc\u062f\u0646 \u062f\u0633\u062a\u06af\u06cc\u0631\u0647\u200c\u0647\u0627 \u0645\u06cc\u062a\u0648\u0627\u0646\u06cc\u062f \u0627\u0646\u062f\u0627\u0632\u0647 \u0645\u0646\u0637\u0642\u0647 \u0631\u0627 \u062a\u063a\u06cc\u06cc\u0631 \u062f\u0647\u06cc\u062f\u060c \u0633\u067e\u0633 \u0631\u0648\u06cc \u062f\u06a9\u0645\u0647 \u062a\u0627\u06cc\u06cc\u062f \u06a9\u0644\u06cc\u06a9 \u06a9\u0646\u06cc\u062f",
            2E3);
        c.editZone()
    };
    this.tileZone = function () {
        c.tileZone()
    };
    this.groutZone = function () {
        c.groutZone()
    };
    this.deleteSingleTile = function () {
        c.deleteSingleTile()
    };
    this.moveSingleTile = function () {
        r.showMessage("\u062c\u0627\u0628\u062c\u0627 \u06a9\u0631\u062f\u0646 \u06a9\u0627\u0634\u06cc", 2E3);
        c.moveSingleTile()
    };
    this.changeSingleTile = function () {
        c.changeSingleTile()
    };
    this.clear = function () {
        c.clear()
    };
    this.undo = function () {
        c.undo()
    };
    this.redo = function () {
        c.redo()
    };
    this.isRoomDecorated = function () {
        return c.isRoomDecorated()
    };
    this.anythingToUndo = function () {
        return c.anythingToUndo()
    };
    this.anythingToRedo = function () {
        return c.anythingToRedo()
    };
    this.getPrintData = function () {
        return c.getPrintData()
    };
    this.sendEmail = function (a, b, d) {
        d.replace(/\r\n|\r|\n/g, "<br />");
        a += " has shared this Tiles Visualiser room with you.<br><br>[[[RENDER]]]";
        a += "<p>" + d + "</p>";
        c.sendEmail("noreply@?????????.com.au", b, "Tiles Visualiser", a)
    };
    this.prepareShare = function (a, b) {
        c.prepareShare(a, "Tiles Visualiser", "I used the Tiles Visualiser", b)
    };
    this.sendShare =
        function () {
            c.sendShare("I used the Tiles Visualiser")
        };
    this.print = function () {
        c.print()
    }
}

var VUtils = {}, vIsTouch = void 0, vInitialTimer = (new Date).getTime(), vLastTimer = (new Date).getTime(),
    vDebugLoggingOn = !1, vImagesCache = [], vRandomSeed = 0;
-1 == location.href.indexOf("cjc-macbookpro") && -1 == location.href.indexOf("localhost") || (vDebugLoggingOn = !0);
VUtils.webGLSupported = function () {
    function a() {
        alert("BogRats")
    }

    function d() {
        alert("context restored")
    }

    if (console.log("New WebGL: Checking"), window.WebGLRenderingContext) {
        var e = document.createElement("canvas"), b = ["webgl", "experimental-webgl", "moz-webgl"], c = !1;
        e.addEventListener("webglcontextlost", a, !0);
        e.addEventListener("webglcontextrestored", d, !0);
        for (var k in b) try {
            if (c = e.getContext(b[k]), c && "function" == typeof c.getParameter) return b[k]
        } catch (n) {
        }
        return console.log("WebGL: Supported, but disabled"),
            !0
    }
    return console.log("WebGL: Not suppported"), !1
};
VUtils.OLDwebGLSupported = function () {
    if (console.log("WebGL: Checking"), window.WebGLRenderingContext) {
        var a = document.createElement("canvas"), d = ["webgl", "experimental-webgl", "moz-webgl"], e = !1, b;
        for (b in d) try {
            if (e = a.getContext(d[b]), e && "function" == typeof e.getParameter) return d[b]
        } catch (c) {
        }
        return console.log("WebGL: Supported, but disabled"), !1
    }
    return console.log("WebGL: Not suppported"), !1
};
VUtils.isTabletOrPhoneDevice = function () {
    return -1 != location.href.indexOf("vit-simtablet") ? !0 : -1 != navigator.userAgent.toLowerCase().indexOf("android") ? !0 : -1 != navigator.userAgent.toLowerCase().indexOf("ipad") ? !0 : -1 != navigator.userAgent.toLowerCase().indexOf("iphone") ? !0 : -1 != navigator.userAgent.toLowerCase().indexOf("ipod") ? !0 : !1
};
VUtils.isDesktopChromeVersion45 = function () {
    return -1 != navigator.userAgent.toLowerCase().indexOf("android") ? !1 : -1 != navigator.userAgent.toLowerCase().indexOf("ipad") ? !1 : -1 != navigator.userAgent.toLowerCase().indexOf("iphone") ? !1 : -1 != navigator.userAgent.toLowerCase().indexOf("ipod") ? !1 : -1 != navigator.userAgent.indexOf("Chrome") && "45" == navigator.userAgent.substring(navigator.userAgent.indexOf("Chrome") + 7, navigator.userAgent.indexOf("Chrome") + 9) ? !0 : !1
};
VUtils.isInternetExplorerBrowser = function () {
    return -1 != navigator.userAgent.indexOf("MSIE") ? !0 : -1 != navigator.userAgent.indexOf("Trident/") ? !0 : -1 != navigator.userAgent.indexOf("Edge/") ? !0 : !1
};
VUtils.isFirefoxBrowser = function () {
    return -1 != navigator.userAgent.indexOf("Firefox") ? !0 : !1
};
VUtils.getBaseURL = function () {
    return (new RegExp(/^.*\//)).exec(window.location.href)
};
VUtils.loadTextFromURL = function (a, d) {
    $.ajax({
        type: "GET", url: a, dataType: "text", success: function (a) {
            d(a)
        }, error: function (d, b, c) {
            verror("loadTextFromURL(): " + a + " - ajax error: jqXHR=" + d + " textStatus=" + b + " errorThrown=" + c)
        }, statusCode: {
            404: function () {
                verror("loadTextFromURL(): " + a + " - 404 page not found")
            }, 405: function () {
                verror("loadTextFromURL(): " + a + " - 405 page not found")
            }
        }
    })
};
VUtils.loadXMLFromURL = function (a, d) {
    $.ajax({
            type: "GET",
            url: 'loade_tile.php' ,
            dataType: "xml",
            success: function (a) {
               // console.log(a);
                d(a)
            }
            , error: function (d, b, c) {
                verror("loadXMLFromURL(): " + a + " - ajax error: jqXHR=" + d + " textStatus=" + b + " errorThrown=" + c)
            }, statusCode: {
                404: function () {
                    verror("loadXMLFromURL(): " + a + " - 404 page not found")
                }, 405: function () {
                    verror("loadXMLFromURL(): " + a + " - 405 page not found")
                }
            }
        });


    // $.ajax({
    //     type: "GET", url: a, dataType: "xml", success: function (a) {
    //        console.log(a);
    //        d(a)
    //     }, error: function (d, b, c) {
    //         verror("loadXMLFromURL(): " + a + " - ajax error: jqXHR=" + d + " textStatus=" + b + " errorThrown=" + c)
    //     }, statusCode: {
    //         404: function () {
    //             verror("loadXMLFromURL(): " + a + " - 404 page not found")
    //         }, 405: function () {
    //             verror("loadXMLFromURL(): " + a + " - 405 page not found")
    //         }
    //     }
    // })
};
VUtils.setRandomSeed = function (a) {
    vRandomSeed = a
};
VUtils.getRandom = function () {
    return vRandomSeed = (9301 * vRandomSeed + 49297) % 233280, vRandomSeed / 233280
};
Array.prototype.indexOf || (Array.prototype.indexOf = function (a, d) {
    d = d || 0;
    for (var e = this.length; e > d; d++) if (this[d] === a) return d;
    return -1
});
VUtils.getGUID = function () {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (a) {
        var d = 16 * Math.random() | 0;
        return ("x" == a ? d : 3 & d | 8).toString(16)
    })
};
VUtils.isPointInPolygon = function (a, d, e) {
    d = new VPoint(d, e);
    e = !1;
    for (var b = -1, c = a.length, k = c - 1; ++b < c; k = b) (a[b].y <= d.y && d.y < a[k].y || a[k].y <= d.y && d.y < a[b].y) && d.x < (a[k].x - a[b].x) * (d.y - a[b].y) / (a[k].y - a[b].y) + a[b].x && (e = !e);
    return e
};
VUtils.loadImageToSrc = function (a, d, e) {
    var b = new Image;
    b.onload = function () {
        $(d).attr("src") != a && $(d).attr("src", a);
        void 0 != e && null != e && e(d, b.width, b.height)
    };
    b.src = a
};
VUtils.loadImageURLIntoCanvas = function (a, d) {
    var e = new Image;
    e.crossOrigin = "Anonymous";
    e.onload = function () {
        canvas = document.createElement("canvas");
        canvas.width = e.width;
        canvas.height = e.height;
        canvas.getContext("2d").drawImage(e, 0, 0);
        d(canvas)
    };
    e.src = a
};
VUtils.loadExactPNGImageURLIntoCanvas = function (a, d) {
    var e = new Image;
    e.onload = function () {
        var a = document.createElement("canvas");
        a.width = e.width;
        a.height = e.height;
        a.getContext("2d").drawImage(e, 0, 0);
        d(a)
    };
    e.src = a
};
VUtils.getCanvasPixel24 = function (a, d, e) {
    a = a.getContext("2d").getImageData(d, e, 1, 1).data;
    d = a[0] << 16;
    return d += a[1] << 8, d + a[2]
};
VUtils.cacheImage = function (a, d) {
    vout("load: " + a);
    var e = new Image;
    e.onload = function () {
        vout("loaded: " + a);
        vImagesCache.push(e);
        void 0 != d && d()
    };
    e.src = a
};
VUtils.saveCookie = function (a, d) {
    var e = new Date;
    e.setMonth(e.getMonth() + 99);
    document.cookie = a + "=" + escape(d) + ";expires=" + e.toGMTString()
};
VUtils.loadCookie = function (a) {
    cookieArray = document.cookie.split(";");
    for (var d = 0; d < cookieArray.length; ++d) {
        var e = cookieArray[d].substr(0, cookieArray[d].indexOf("=")),
            b = cookieArray[d].substr(cookieArray[d].indexOf("=") + 1);
        if (-1 == cookieArray[d].indexOf("=") && (e = cookieArray[d], b = ""), e = e.replace(/^\s+|\s+$/g, ""), e == a) return unescape(b)
    }
    return null
};
VUtils.drawImage = function (a, d, e, b, c, k, n, p, t, u) {
    var g = t / b, w = u / c, y = d + b - a.width;
    0 < y && (b -= y, t -= y * g);
    y = e + c - a.height;
    0 < y && (c -= y, u -= y * w);
    0 > d && (n -= d * g, t += d * g, b += d, d = 0);
    0 > e && (p -= e * w, u += e * w, c += e, e = 0);
    k.drawImage(a, d, e, b, c, n, p, t, u)
};
VUtils.getScaledImage = function (a, d) {
    var e = a.width * d;
    d *= a.height;
    var b = document.createElement("canvas");
    return b.width = e, b.height = d, b.getContext("2d").drawImage(a, 0, 0, a.width, a.height, 0, 0, e, d), b
};
VUtils.GetQueryStringParam = function (a) {
    for (var d = window.location.search.substring(1).split("&"), e = 0; e < d.length; ++e) {
        var b = d[e].split("=");
        if (b[0] == a) return b[1]
    }
    return null
};
VUtils.convertRGBToHex = function (a, d, e) {
    return (("0" + parseInt(a, 10).toString(16)).slice(-2) + ("0" + parseInt(d, 10).toString(16)).slice(-2) + ("0" + parseInt(e, 10).toString(16)).slice(-2)).toUpperCase()
};
VUtils.loadiPadPhoto = function (a, d) {
    var e = new FileReader;
    e.onload = function (a) {
        a = atob(e.result.split(",")[1]);
        var b = EXIF.readFromBinaryFile(new BinaryFile(a)), k = new Image;
        k.src = e.result;
        k.onload = function () {
            VUtils.getFixedPhotoImage(k, b.Orientation, function (a) {
                void 0 != d && d(a)
            })
        }
    };
    e.readAsDataURL(a)
};
VUtils.getFixedPhotoImage = function (a, d, e) {
    var b = document.createElement("canvas");
    (function (a, b, c) {
        var d = a.naturalWidth, e = a.naturalHeight, g = a.width, k = a.height, n = b.getContext("2d");
        n.save();
        switch (c) {
            case 5:
            case 6:
            case 7:
            case 8:
                b.width = k;
                b.height = g;
                break;
            default:
                b.width = g, b.height = k
        }
        b = b.getContext("2d");
        switch (c) {
            case 2:
                b.translate(g, 0);
                b.scale(-1, 1);
                break;
            case 3:
                b.translate(g, k);
                b.rotate(Math.PI);
                break;
            case 4:
                b.translate(0, k);
                b.scale(1, -1);
                break;
            case 5:
                b.rotate(.5 * Math.PI);
                b.scale(1, -1);
                break;
            case 6:
                b.rotate(.5 *
                    Math.PI);
                b.translate(0, -k);
                break;
            case 7:
                b.rotate(.5 * Math.PI);
                b.translate(g, -k);
                b.scale(-1, 1);
                break;
            case 8:
                b.rotate(-.5 * Math.PI), b.translate(-g, 0)
        }
        c = a.naturalWidth;
        1048576 < c * a.naturalHeight ? (b = document.createElement("canvas"), b.width = b.height = 1, b = b.getContext("2d"), c = (b.drawImage(a, -c + 1, 0), 0 === b.getImageData(0, 0, 1, 1).data[3])) : c = !1;
        c && (d /= 2, e /= 2);
        c = document.createElement("canvas");
        c.width = c.height = 1024;
        b = c.getContext("2d");
        var q = e, l = document.createElement("canvas");
        l.width = 1;
        l.height = q;
        l = l.getContext("2d");
        l.drawImage(a, 0, 0);
        l = l.getImageData(0, 0, 1, q).data;
        for (var p = 0, f = q, h = q; h > p;) 0 === l[4 * (h - 1) + 3] ? f = h : p = h, h = f + p >> 1;
        q = h / q;
        g = Math.ceil(1024 * g / d);
        k = Math.ceil(1024 * k / e / (0 === q ? 1 : q));
        for (l = q = 0; e > q;) {
            for (f = p = 0; d > p;) b.clearRect(0, 0, 1024, 1024), b.drawImage(a, -p, -q), n.drawImage(c, 0, 0, 1024, 1024, f, l, g, k), p += 1024, f += g;
            q += 1024;
            l += k
        }
        n.restore()
    })(a, b, d);
    var c = new Image;
    c.onload = function () {
        void 0 != e && e(c)
    };
    c.src = b.toDataURL("image/png")
};
VUtils.callAfterScreenRefresh = function (a, d, e, b, c, k, n, p, t, u, g, w, y, q, l, z, f, h, m, r, C) {
    setTimeout(function () {
        a(d, e, b, c, k, n, p, t, u, g, w, y, q, l, z, f, h, m, r, C)
    }, 25)
};
VUtils.callAfterScreenRefresh2 = function (a, d, e, b, c, k, n, p, t, u, g, w, y, q, l, z, f, h, m, r, C) {
    setTimeout(function () {
        a(d, e, b, c, k, n, p, t, u, g, w, y, q, l, z, f, h, m, r, C)
    }, 600)
};
VUtils.clone = function (a) {
    if (!a || "object" != typeof a || "[object Function]" === Object.prototype.toString.call(a)) return a;
    if (a.nodeType && "cloneNode" in a) return a.cloneNode(!0);
    if (a instanceof Date) return new Date(a.getTime());
    if (a instanceof RegExp) return new RegExp(a);
    var d;
    if (a instanceof Array) {
        var e = [];
        var b = 0;
        for (d = a.length; d > b; ++b) b in a && e.push(VUtils.clone(a[b]))
    } else e = a.constructor ? new a.constructor : {};
    b = VUtils.clone;
    var c, k = {};
    for (c in a) d = a[c], c in e && (e[c] === d || c in k && k[c] === d) || (e[c] = b ?
        b(d) : d);
    return e
};
var devMode = !1;
-1 == location.href.indexOf("localhost") && -1 == location.href.indexOf("cjc-macbookpro") || (devMode = !0);